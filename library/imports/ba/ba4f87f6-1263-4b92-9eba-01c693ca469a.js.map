{"version":3,"sources":["assets\\script\\Bullet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport Common from \"./Common\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Bullet extends cc.Component {   \r\n \r\n    // 飞行的方位 (标准化向量)\r\n    direction : cc.Vec2 = null;\r\n\r\n    // 靶标\r\n    target : cc.Node = null;\r\n\r\n    // 爆炸特效\r\n    explodeEffect: cc.SpriteFrame = null;\r\n\r\n    // 音效\r\n    audioExplode : cc.AudioClip = null;\r\n\r\n    onLoad () {\r\n        \r\n    }\r\n\r\n    start () {\r\n        if(this.target == null) { cc.log('未设置靶标 target 属性!'); return; }\r\n        if(this.explodeEffect == null) { cc.log('未设置爆炸特效 explodeEffect 属性!'); return; }\r\n\r\n        this.schedule(this.onTimer, 0.016);\r\n    }\r\n\r\n    onTimer(){\r\n        if(this.node.y > 400)  // 靶标与射击基准之间的距离\r\n        {\r\n            this.unschedule(this.onTimer);  \r\n\r\n            if(this.isHit())\r\n                this.success();\r\n            else\r\n                this.failed();  \r\n\r\n            return;    \r\n        }\r\n\r\n        let speed : number = 15; // 步长\r\n        let dx = speed * this.direction.x;\r\n        let dy = speed * this.direction.y;\r\n        \r\n        this.node.x += dx;\r\n        this.node.y += dy;\r\n    }\r\n   \r\n    dismiss(){\r\n        this.node.destroy();\r\n        \r\n        if(Common.magazine.count <= 0)\r\n        {\r\n            Common.resultDialog.show();\r\n        }\r\n    }\r\n\r\n    // 检查是否命中目标\r\n    isHit() : boolean { \r\n        let targetPos :cc.Vec2 = this.getWorldLocation(this.target);\r\n        let selfPos: cc.Vec2 = this.getWorldLocation(this.node);\r\n        let distance : number = Math.abs( targetPos.x - selfPos.x) ;  // x方向距离\r\n        // let distance : number = cc.Vec2.distance(targetPos, selfPos);\r\n        cc.log('靶标x=' + targetPos.x + ', 子弹x=' + selfPos.x);\r\n        \r\n        if(distance < 50) return true;       \r\n        return false;\r\n    }\r\n\r\n    // 获取一个节点的世界坐标\r\n    getWorldLocation( node : cc.Node) : cc.Vec2 {\r\n        let pos = node.getPosition();\r\n        return node.parent.convertToWorldSpaceAR( pos );\r\n    }\r\n\r\n    success(){        \r\n        // 此处应添加特效\r\n\r\n        cc.log('命中目标');\r\n        // this.dismiss();   \r\n        \r\n        this.explode();\r\n        this.cheer();   \r\n        \r\n        // 得分\r\n        Common.score += 10;\r\n\r\n        // 音效\r\n        if(this.audioExplode!=null)\r\n            cc.audioEngine.play(this.audioExplode, false, 1);\r\n    }\r\n\r\n    failed(){\r\n        cc.log('脱靶!');\r\n        this.dismiss(); // 直接销毁\r\n    }\r\n\r\n    // 爆炸特效\r\n    explode(){\r\n        cc.log('爆炸效果..');\r\n        let sp : cc.Sprite = this.node.getComponent(cc.Sprite);\r\n        sp.spriteFrame = this.explodeEffect;\r\n\r\n        this.node.scale = 0.1;\r\n\r\n        let self = this;\r\n        cc.tween(this.node)\r\n            .to(0.4, { scale: 1 } )\r\n            .to(0.2, { opacity: 0} )\r\n            .call( function(){ self.dismiss(); } )\r\n            .start();\r\n    }\r\n\r\n    // 加分效果\r\n    cheer(){\r\n        let labelNode : cc.Node = new cc.Node();\r\n        let label : cc.Label = labelNode.addComponent(cc.Label);\r\n        label.string = \"+10分\";\r\n        labelNode.color = new cc.Color(255,0,0);\r\n        labelNode.parent = this.node.parent;\r\n        labelNode.setPosition(cc.v3(0, 250, 0));\r\n        labelNode.opacity = 200;\r\n\r\n        cc.tween(labelNode)\r\n            .to(0.5, {scale: 1.5})\r\n            .to(0.2, {opacity: 0})\r\n            .call( function(){ labelNode.destroy(); } )\r\n            .start();\r\n    }\r\n\r\n}\r\n"]}